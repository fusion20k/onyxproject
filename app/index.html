<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Workspace - Onyx</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/workspace.css">
</head>
<body class="workspace-page">
    <div class="workspace-container">
        <!-- Main Content -->
        <main class="workspace-main">
            <!-- Loading State -->
            <div id="loading-state" class="workspace-state">
                <div class="workspace-content">
                    <p class="workspace-loading">Loading workspace...</p>
                </div>
            </div>

            <!-- Unauthorized State -->
            <div id="unauthorized-state" class="workspace-state" style="display: none;">
                <div class="workspace-content" style="text-align: center; padding-top: 120px;">
                    <h1 class="workspace-error-title">Access Denied</h1>
                    <p class="workspace-error-text">You must be logged in and have an active subscription.</p>
                    <a href="/invite" class="workspace-cta">Get Access</a>
                </div>
            </div>

            <!-- Unpaid State -->
            <div id="unpaid-state" class="workspace-state" style="display: none;">
                <div class="workspace-content" style="text-align: center; padding-top: 120px;">
                    <h1 class="workspace-error-title">Payment Required</h1>
                    <p class="workspace-error-text">Please complete payment to access your workspace.</p>
                    <a href="/payment" class="workspace-cta">Complete Payment</a>
                </div>
            </div>

            <!-- First-Time User: Initial Prompt -->
            <div id="first-time-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <h1 class="workspace-header-title">Workspace</h1>
                    <div class="user-account-menu">
                        <button class="user-account-trigger" id="user-account-trigger-first">
                            <span id="header-username-first">User</span>
                        </button>
                        <div class="user-account-dropdown" id="user-account-dropdown-first">
                            <div class="user-account-dropdown-label">Account</div>
                            <div class="user-account-dropdown-item" data-action="settings">Settings</div>
                            <div class="user-account-dropdown-item" data-action="payment">Payment details</div>
                            <div class="user-account-dropdown-item" data-action="logout">Logout</div>
                        </div>
                    </div>
                </div>
                
                <div class="workspace-content">
                    <div class="empty-state">
                        <p style="margin-bottom: 32px; max-width: 600px; margin-left: auto; margin-right: auto;">This space is private. Use it to work through a decision that matters.</p>
                        
                        <button id="initial-start-btn" class="btn btn-primary">Start new decision</button>
                    </div>
                </div>
            </div>
            <!-- Workspace Hub (Overview) -->
            <div id="hub-state" class="workspace-state" style="display: none;">
                <!-- Header -->
                <div class="workspace-header">
                    <h1 class="workspace-header-title">Workspace</h1>
                    <div class="user-account-menu">
                        <button class="user-account-trigger" id="user-account-trigger">
                            <span id="header-username">User</span>
                        </button>
                        <div class="user-account-dropdown" id="user-account-dropdown">
                            <div class="user-account-dropdown-label">Account</div>
                            <div class="user-account-dropdown-item" id="account-payment">Payment details</div>
                            <div class="user-account-dropdown-item" id="account-logout">Logout</div>
                        </div>
                    </div>
                </div>

                <div class="hub-content-wrapper">
                    <!-- Sidebar -->
                    <div class="workspace-sidebar">
                        <nav class="workspace-sidebar-nav">
                            <button class="sidebar-nav-item active" data-view="active">Active</button>
                            <button class="sidebar-nav-item" data-view="library">Library</button>
                            <button class="sidebar-nav-item" data-view="settings">Settings</button>
                        </nav>
                    </div>

                    <!-- Main Content Area -->
                    <div class="workspace-main-area">
                    <!-- Active Decision View -->
                    <div id="active-view" class="workspace-view">
                        <div class="workspace-view-header">
                            <div class="workspace-view-header-content">
                                <h1 class="workspace-view-title">Active decision</h1>
                                <p class="workspace-view-subtitle">Only one active decision at a time.</p>
                            </div>
                        </div>
                        <div class="workspace-content workspace-content-tight">
                            <div class="workspace-content-column">
                                <!-- Active Decision Card -->
                                <div id="active-decision-section" style="display: none;">
                                    <div class="active-decision-card-label">Current decision</div>
                                    <div id="active-decision-card" class="active-decision-card">
                                        <div class="active-decision-content">
                                            <div class="active-decision-title" id="active-decision-title">Decision title</div>
                                            <div class="active-decision-meta" id="active-decision-status-line">Status: Draft - Reviewed: Today</div>
                                        </div>
                                        <div class="active-decision-actions">
                                            <button id="open-decision-btn" class="btn btn-primary">Resume decision</button>
                                        </div>
                                    </div>
                                    <div id="single-decision-nudge" class="low-state-nudge" style="display: none;">
                                        Onyx works best when every serious decision lives here.
                                    </div>
                                    <a href="#" id="view-library-link" class="view-library-link">View decision library →</a>
                                </div>

                                <!-- Empty State (no active decision) -->
                                <div id="no-active-decision" class="empty-state-minimal" style="display: none;">
                                    <p class="text-dim">You don't have an active decision.</p>
                                    <button id="start-new-decision-btn" class="btn btn-primary">Start a decision</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Library View -->
                    <div id="library-view" class="workspace-view" style="display: none;">
                        <div class="workspace-view-header">
                            <div class="workspace-view-header-content">
                                <h1 class="workspace-view-title" id="library-title">Decision library</h1>
                                <p class="workspace-view-subtitle">All decisions you've worked through in Onyx.</p>
                            </div>
                            <div class="filter-label-group">
                                <span class="filter-label-text">Stage:</span>
                                <select id="decisions-filter" class="filter-dropdown">
                                    <option value="all">All</option>
                                    <option value="draft">Draft</option>
                                    <option value="in_review">In review</option>
                                    <option value="committed">Committed</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                        </div>
                        <div class="workspace-content">
                            <div class="workspace-content-column">
                                <div id="decisions-list" class="decisions-list">
                                    <!-- Decisions populated by JS -->
                                </div>
                                <div id="library-empty-state" class="library-empty-state" style="display: none;">
                                    <p class="text-dim">No decisions match these filters yet.</p>
                                    <button id="library-start-btn" class="btn btn-primary">Start a new decision</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings View -->
                    <div id="settings-view" class="workspace-view" style="display: none;">
                        <div class="workspace-view-header">
                            <div class="workspace-view-header-content">
                                <h1 class="workspace-view-title">Settings</h1>
                                <p class="workspace-view-subtitle">Manage your personal details and account.</p>
                            </div>
                        </div>
                        <div class="workspace-content">
                            <div class="workspace-content-column">
                                <div class="settings-form-card">
                                    <div class="form-section">
                                        <label class="form-label">Display Name</label>
                                        <input type="text" id="settings-display-name-hub" class="input" placeholder="Your name" />
                                    </div>

                                    <div class="form-section">
                                        <label class="form-label">Email</label>
                                        <input type="email" id="settings-email-hub" class="input" disabled />
                                        <p class="text-dim" style="font-size: 0.8125rem; margin-top: 8px;">Email cannot be changed</p>
                                    </div>

                                    <div class="settings-save-message" id="settings-save-message-hub" style="display: none; color: rgba(255, 255, 255, 0.6); font-size: 0.875rem; margin-top: 12px;">
                                        Settings saved
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>


            <!-- Step 1: Frame the Decision -->
            <div id="decision-step1-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <h1 class="workspace-header-title">Frame the decision</h1>
                    <button id="back-from-step1" class="btn-text">← Back</button>
                </div>
                
                <div class="workspace-content">
                    <div class="decision-step-form">
                        <div class="form-section">
                            <label class="form-label">What decision are you making?</label>
                            <input type="text" id="step1-title" class="input" placeholder="Decision title" />
                        </div>

                        <div class="form-section">
                            <label class="form-label">What is at stake if you get this wrong?</label>
                            <textarea id="step1-stakes" class="input" rows="4" placeholder="Stakes..."></textarea>
                        </div>

                        <div class="form-section">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="step1-time-sensitive" />
                                <span class="text-body">This is time-sensitive</span>
                            </label>
                            <input type="date" id="step1-deadline" class="input" style="margin-top: 12px; display: none;" />
                        </div>

                        <button id="step1-next" class="btn btn-primary">Next: Options</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Options & Expectations -->
            <div id="decision-step2-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <h1 class="workspace-header-title">What could you do?</h1>
                    <button id="back-from-step2" class="btn-text">← Back</button>
                </div>
                
                <div class="workspace-content">
                    <div class="decision-step-form">
                        <div id="step2-options-container"></div>
                        
                        <p class="text-dim" style="margin: 16px 0;">Two strong options are enough.</p>

                        <div class="form-section">
                            <label class="form-label">Current favorite</label>
                            <div id="step2-favorite-radios"></div>
                        </div>

                        <button id="step2-next" class="btn btn-primary">Next: Commit</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Commit & Check -->
            <div id="decision-step3-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <h1 class="workspace-header-title">Commit to a move</h1>
                    <button id="back-from-step3" class="btn-text">← Back</button>
                </div>
                
                <div class="workspace-content">
                    <div class="decision-step-form">
                        <div class="form-section">
                            <label class="form-label">Your choice</label>
                            <select id="step3-choice" class="input">
                                <option value="">Select option...</option>
                            </select>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Why this move now?</label>
                            <textarea id="step3-reasoning" class="input" rows="4"></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">What would make you change your mind?</label>
                            <textarea id="step3-change-mind" class="input" rows="3"></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">First action you will take (optional)</label>
                            <input type="text" id="step3-first-action" class="input" />
                        </div>

                        <button id="step3-save" class="btn btn-primary">Save decision</button>
                    </div>
                </div>
            </div>

            <!-- Decision Summary View -->
            <div id="decision-summary-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <h1 class="workspace-header-title" id="summary-title">Decision</h1>
                    <button id="back-from-summary" class="btn-text">← Back</button>
                </div>
                
                <div class="workspace-content">
                    <div class="decision-summary">
                        <div class="summary-meta">
                            <span id="summary-stage">Committed</span>
                            <span class="text-dim"> • </span>
                            <span class="text-dim" id="summary-date">Today</span>
                        </div>

                        <div class="summary-section">
                            <h3 class="summary-section-title">Stakes</h3>
                            <p id="summary-stakes" class="summary-text"></p>
                        </div>

                        <div class="summary-section">
                            <h3 class="summary-section-title">Options considered</h3>
                            <div id="summary-options"></div>
                        </div>

                        <div class="summary-section">
                            <h3 class="summary-section-title">Why you chose this</h3>
                            <p id="summary-reasoning" class="summary-text"></p>
                        </div>

                        <div class="summary-actions">
                            <button id="summary-edit" class="btn">Edit details</button>
                            <button id="summary-support" class="btn">Request a second opinion on this decision</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resolution State -->
            <div id="resolution-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <div class="workspace-header-left">
                        <h1 class="workspace-title">Resolve Decision</h1>
                    </div>
                    <button id="logout-btn-3" class="workspace-logout-btn">Logout</button>
                </div>

                <div class="workspace-content">
                    <form id="resolution-form" class="workspace-form">
                        <div class="form-section">
                            <label for="final-direction" class="form-label">Final Direction</label>
                            <textarea id="final-direction" name="final_direction" rows="4" placeholder="What did you decide?" required></textarea>
                        </div>

                        <div class="form-section">
                            <label for="reasoning" class="form-label">Reasoning</label>
                            <textarea id="reasoning" name="reasoning" rows="6" placeholder="Why did you make this choice?" required></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Immediate Next Steps (1-3)</label>
                            <input type="text" id="next-step-1" placeholder="1. First action step" required>
                            <input type="text" id="next-step-2" placeholder="2. Second action step" required>
                            <input type="text" id="next-step-3" placeholder="3. Third action step (optional)">
                        </div>

                        <button type="submit" class="workspace-submit">Mark as Resolved</button>
                    </form>
                </div>
            </div>

            <!-- Archive List -->
            <div id="archive-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <div class="workspace-header-left">
                        <h1 class="workspace-title">Archived Decisions</h1>
                    </div>
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <button id="new-decision-btn" class="workspace-cta">New Decision</button>
                        <button id="logout-btn-4" class="workspace-logout-btn">Logout</button>
                    </div>
                </div>

                <div class="workspace-content">
                    <div id="archive-list" class="archive-list"></div>
                </div>
            </div>

            <!-- Archive Detail (Read-Only) -->
            <div id="archive-detail-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <div class="workspace-header-left">
                        <button id="back-to-archive-btn" class="workspace-back">← Back to Archive</button>
                    </div>
                    <button id="logout-btn-5" class="workspace-logout-btn">Logout</button>
                </div>

                <div class="workspace-content">
                    <div id="archive-detail-content"></div>
                </div>
            </div>

            <!-- Insights Page -->
            <div id="insights-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <div class="workspace-header-left">
                        <button id="back-to-hub-insights" class="workspace-back-btn">← Back</button>
                        <h1 class="workspace-title">Insights</h1>
                    </div>
                </div>
                
                <div class="workspace-content">
                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-value" id="insights-resolved">0</div>
                            <div class="insight-label">Decisions Resolved</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-value" id="insights-avg-time">—</div>
                            <div class="insight-label">Avg. Time to Resolution</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-value" id="insights-last-resolved">—</div>
                            <div class="insight-label">Last Resolved</div>
                        </div>
                    </div>
                    
                    <div class="insights-section">
                        <h3>Recent Decisions</h3>
                        <div id="insights-recent-list" class="insights-recent-list"></div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <h1 class="workspace-header-title">Settings</h1>
                    <button id="back-from-settings" class="btn-text">← Back</button>
                </div>
                
                <div class="workspace-content">
                    <div class="settings-form">
                        <div class="form-section">
                            <label class="form-label">Display Name</label>
                            <input type="text" id="settings-display-name" class="input" placeholder="Your name" />
                        </div>

                        <div class="form-section">
                            <label class="form-label">Email</label>
                            <input type="email" id="settings-email" class="input" disabled />
                            <p class="text-dim" style="font-size: 0.8125rem; margin-top: 8px;">Email cannot be changed</p>
                        </div>

                        <div class="settings-save-message" id="settings-save-message" style="display: none; color: rgba(255, 255, 255, 0.6); font-size: 0.875rem; margin-top: 12px;">
                            Settings saved
                        </div>
                    </div>
                </div>
            </div>

            <!-- Support Request Modal -->
            <div id="support-modal" class="support-modal" style="display: none;">
                <div class="support-modal-content">
                    <h2>Request Support</h2>
                    <form id="support-form">
                        <label>Reason</label>
                        <select id="support-reason">
                            <option value="clarification">Clarification</option>
                            <option value="follow-up">Follow-up</option>
                            <option value="priority">Priority Concern</option>
                        </select>
                        <label>Details</label>
                        <textarea id="support-details" required placeholder="Describe your support request..."></textarea>
                        <div class="support-actions">
                            <button type="button" id="support-cancel">Cancel</button>
                            <button type="submit">Send Request</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/workspace.js"></script>
</body>
</html>
