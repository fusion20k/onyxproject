<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Workspace - Onyx</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/workspace.css">
</head>
<body class="workspace-page">
    <div class="workspace-container">
        <!-- Main Content -->
        <main class="workspace-main">
            <!-- Loading State -->
            <div id="loading-state" class="workspace-state">
                <div class="workspace-content">
                    <p class="workspace-loading">Loading workspace...</p>
                </div>
            </div>

            <!-- Unauthorized State -->
            <div id="unauthorized-state" class="workspace-state" style="display: none;">
                <div class="workspace-content" style="text-align: center; padding-top: 120px;">
                    <h1 class="workspace-error-title">Access Denied</h1>
                    <p class="workspace-error-text">You must be logged in and have an active subscription.</p>
                    <a href="/invite" class="workspace-cta">Get Access</a>
                </div>
            </div>

            <!-- Unpaid State -->
            <div id="unpaid-state" class="workspace-state" style="display: none;">
                <div class="workspace-content" style="text-align: center; padding-top: 120px;">
                    <h1 class="workspace-error-title">Payment Required</h1>
                    <p class="workspace-error-text">Please complete payment to access your workspace.</p>
                    <a href="/payment" class="workspace-cta">Complete Payment</a>
                </div>
            </div>

            <!-- First-Time User: Initial Prompt -->
            <div id="first-time-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <h1 class="workspace-header-title">Workspace</h1>
                    <span class="workspace-header-info">Private session</span>
                </div>
                
                <div class="workspace-content">
                    <div class="empty-state">
                        <p style="margin-bottom: 24px; max-width: 600px; margin-left: auto; margin-right: auto;">This space is private. Use it to work through a decision that matters. Begin by describing the situation you are facing.</p>
                        
                        <form id="initial-decision-form" style="max-width: 700px; margin: 0 auto;">
                            <div class="form-section">
                                <label for="situation" class="form-label">Situation</label>
                                <textarea id="situation" name="situation" class="input" rows="10" placeholder="Describe the decision you need to make..." required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Create Decision</button>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Workspace Hub (Overview) -->
            <div id="hub-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <h1 class="workspace-header-title">Workspace</h1>
                    <span class="workspace-header-info">Private session</span>
                </div>
                
                <div class="workspace-content">
                    <!-- Active Decision Card -->
                    <div id="active-decision-card" class="active-decision-card" style="display: none;">
                        <div class="active-decision-content">
                            <div class="active-decision-title" id="active-decision-title">Decision title</div>
                            <div class="active-decision-meta"><strong>Stage:</strong> <span id="active-decision-stage">In progress</span></div>
                            <div class="active-decision-meta"><strong>Next step:</strong> <span id="active-decision-next">Complete decision form</span></div>
                        </div>
                        <div class="active-decision-actions">
                            <button id="open-decision-btn" class="btn btn-primary">Open</button>
                        </div>
                    </div>

                    <!-- Empty State (no active decision) -->
                    <div id="no-active-decision" class="empty-state" style="display: none;">
                        <button id="start-new-decision-btn" class="btn btn-primary">Start New Decision</button>
                    </div>

                    <!-- All Decisions Section -->
                    <div class="decisions-section">
                        <div class="decisions-section-header">
                            <h2 class="text-section-title">All decisions</h2>
                            <select id="decisions-filter" class="filter-dropdown">
                                <option value="all">All</option>
                                <option value="active">Active</option>
                                <option value="resolved">Resolved</option>
                            </select>
                        </div>
                        <div id="decisions-list" class="decisions-list">
                            <!-- Decisions populated by JS -->
                        </div>
                    </div>
                </div>
            </div>


            <!-- Active Decision: Structured Form -->
            <div id="decision-form-state" class="workspace-state" style="display: none;">
                <div class="decision-header">
                    <div class="decision-header-top">
                        <button id="back-to-hub-btn" class="btn-text">← Back</button>
                    </div>
                    <input type="text" id="decision-title-input" class="decision-title-input" placeholder="Decision title" />
                    <div class="decision-meta-line">
                        <span id="decision-stage-text">Stage: In progress</span>
                        <span class="text-dim"> • </span>
                        <span class="text-dim" id="decision-updated-text">Updated today</span>
                    </div>
                </div>

                <div class="decision-body">
                    <!-- 1. Context -->
                    <div class="decision-section">
                        <h2 class="decision-section-title">Context</h2>
                        <p class="text-dim" style="margin-bottom: 16px;">What led to this decision? What constraints or deadlines matter?</p>
                        <textarea id="context" class="input" rows="6" placeholder="Describe the context..."></textarea>
                    </div>

                    <!-- 2. Options -->
                    <div class="decision-section">
                        <h2 class="decision-section-title">Options</h2>
                        <p class="text-dim" style="margin-bottom: 16px;">What are the possible paths forward?</p>
                        <div id="options-list" class="options-list">
                            <!-- Options populated by JS -->
                        </div>
                        <button id="add-option-btn" class="btn" style="margin-top: 16px;">Add option</button>
                    </div>

                    <!-- 3. Choice & expectations -->
                    <div class="decision-section">
                        <h2 class="decision-section-title">Choice & expectations</h2>
                        <div class="form-section">
                            <label class="form-label">Which option are you leaning toward?</label>
                            <textarea id="choice" class="input" rows="3" placeholder="Your current thinking..."></textarea>
                        </div>
                        <div class="form-section">
                            <label class="form-label">What outcome do you expect?</label>
                            <textarea id="expectations" class="input" rows="4" placeholder="Expected results..."></textarea>
                        </div>
                    </div>

                    <!-- 4. Feelings & risks -->
                    <div class="decision-section">
                        <h2 class="decision-section-title">Feelings & risks</h2>
                        <div class="form-section">
                            <label class="form-label">How do you feel about this decision?</label>
                            <textarea id="feelings" class="input" rows="3" placeholder="Your emotional response..."></textarea>
                        </div>
                        <div class="form-section">
                            <label class="form-label">What could go wrong?</label>
                            <textarea id="risks" class="input" rows="4" placeholder="Potential risks..."></textarea>
                        </div>
                    </div>

                    <!-- 5. Follow-up -->
                    <div class="decision-section">
                        <h2 class="decision-section-title">Follow-up</h2>
                        <div class="form-section">
                            <label class="form-label">What immediate next steps will you take?</label>
                            <input type="text" id="next-step-1" class="input" placeholder="1. First action" style="margin-bottom: 12px;" />
                            <input type="text" id="next-step-2" class="input" placeholder="2. Second action" style="margin-bottom: 12px;" />
                            <input type="text" id="next-step-3" class="input" placeholder="3. Third action (optional)" />
                        </div>
                    </div>

                    <!-- Support section at bottom -->
                    <div class="decision-section" style="border-top: 1px solid rgba(255,255,255,0.15); padding-top: 40px;">
                        <h2 class="decision-section-title">Support</h2>
                        <p class="text-dim" style="margin-bottom: 16px;">Need help with this decision?</p>
                        <button id="request-support-btn" class="btn">Request support</button>
                    </div>
                </div>
            </div>

            <!-- Resolution State -->
            <div id="resolution-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <div class="workspace-header-left">
                        <h1 class="workspace-title">Resolve Decision</h1>
                    </div>
                    <button id="logout-btn-3" class="workspace-logout-btn">Logout</button>
                </div>

                <div class="workspace-content">
                    <form id="resolution-form" class="workspace-form">
                        <div class="form-section">
                            <label for="final-direction" class="form-label">Final Direction</label>
                            <textarea id="final-direction" name="final_direction" rows="4" placeholder="What did you decide?" required></textarea>
                        </div>

                        <div class="form-section">
                            <label for="reasoning" class="form-label">Reasoning</label>
                            <textarea id="reasoning" name="reasoning" rows="6" placeholder="Why did you make this choice?" required></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Immediate Next Steps (1-3)</label>
                            <input type="text" id="next-step-1" placeholder="1. First action step" required>
                            <input type="text" id="next-step-2" placeholder="2. Second action step" required>
                            <input type="text" id="next-step-3" placeholder="3. Third action step (optional)">
                        </div>

                        <button type="submit" class="workspace-submit">Mark as Resolved</button>
                    </form>
                </div>
            </div>

            <!-- Archive List -->
            <div id="archive-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <div class="workspace-header-left">
                        <h1 class="workspace-title">Archived Decisions</h1>
                    </div>
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <button id="new-decision-btn" class="workspace-cta">New Decision</button>
                        <button id="logout-btn-4" class="workspace-logout-btn">Logout</button>
                    </div>
                </div>

                <div class="workspace-content">
                    <div id="archive-list" class="archive-list"></div>
                </div>
            </div>

            <!-- Archive Detail (Read-Only) -->
            <div id="archive-detail-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <div class="workspace-header-left">
                        <button id="back-to-archive-btn" class="workspace-back">← Back to Archive</button>
                    </div>
                    <button id="logout-btn-5" class="workspace-logout-btn">Logout</button>
                </div>

                <div class="workspace-content">
                    <div id="archive-detail-content"></div>
                </div>
            </div>

            <!-- Insights Page -->
            <div id="insights-state" class="workspace-state" style="display: none;">
                <div class="workspace-header">
                    <div class="workspace-header-left">
                        <button id="back-to-hub-insights" class="workspace-back-btn">← Back</button>
                        <h1 class="workspace-title">Insights</h1>
                    </div>
                </div>
                
                <div class="workspace-content">
                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-value" id="insights-resolved">0</div>
                            <div class="insight-label">Decisions Resolved</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-value" id="insights-avg-time">—</div>
                            <div class="insight-label">Avg. Time to Resolution</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-value" id="insights-last-resolved">—</div>
                            <div class="insight-label">Last Resolved</div>
                        </div>
                    </div>
                    
                    <div class="insights-section">
                        <h3>Recent Decisions</h3>
                        <div id="insights-recent-list" class="insights-recent-list"></div>
                    </div>
                </div>
            </div>

            <!-- Support Request Modal -->
            <div id="support-modal" class="support-modal" style="display: none;">
                <div class="support-modal-content">
                    <h2>Request Support</h2>
                    <form id="support-form">
                        <label>Reason</label>
                        <select id="support-reason">
                            <option value="clarification">Clarification</option>
                            <option value="follow-up">Follow-up</option>
                            <option value="priority">Priority Concern</option>
                        </select>
                        <label>Details</label>
                        <textarea id="support-details" required placeholder="Describe your support request..."></textarea>
                        <div class="support-actions">
                            <button type="button" id="support-cancel">Cancel</button>
                            <button type="submit">Send Request</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/workspace.js"></script>
</body>
</html>
