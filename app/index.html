<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Workspace - Onyx</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/workspace.css">
</head>
<body class="workspace-page">
    <div class="workspace-container">
        <!-- Main Content -->
        <main class="workspace-main">
            <!-- Loading State -->
            <div id="loading-state" class="workspace-state">
                <div class="workspace-content">
                    <p class="workspace-loading">Loading workspace...</p>
                </div>
            </div>

            <!-- Unauthorized State -->
            <div id="unauthorized-state" class="workspace-state" style="display: none;">
                <div class="workspace-content" style="text-align: center; padding-top: 120px;">
                    <h1 class="workspace-error-title">Access Denied</h1>
                    <p class="workspace-error-text">You must be logged in and have an active subscription.</p>
                    <a href="/invite" class="workspace-cta">Get Access</a>
                </div>
            </div>

            <!-- Unpaid State -->
            <div id="unpaid-state" class="workspace-state" style="display: none;">
                <div class="workspace-content" style="text-align: center; padding-top: 120px;">
                    <h1 class="workspace-error-title">Payment Required</h1>
                    <p class="workspace-error-text">Please complete payment to access your workspace.</p>
                    <a href="/payment" class="workspace-cta">Complete Payment</a>
                </div>
            </div>

            <!-- First-Time Experience -->
            <div id="first-time-state" class="workspace-state" style="display: none;">
                <div class="first-time-container">
                    <div class="first-time-header">
                        <h1>Tell Onyx what you're deciding.</h1>
                        <p class="first-time-subtitle">Get a real response, not a thread of opinions.</p>
                    </div>
                    
                    <div class="first-time-guidance">
                        <p>Start by pasting any context you already have â€” notes, screenshots, thoughts, or drafts.</p>
                        <p>The more context you provide, the sharper the feedback.</p>
                    </div>
                    
                    <div class="first-time-input-container">
                        <textarea id="first-message-input" class="message-textarea" placeholder="What decision are you stuck on? What's at stake if you choose wrong?"></textarea>
                        <div class="file-upload-zone" id="first-file-upload">
                            <input type="file" id="first-file-input" accept="image/png,image/jpeg,application/pdf" style="display: none;">
                            <button type="button" class="btn-attach" id="first-attach-btn">ðŸ“Ž Attach file</button>
                            <span class="file-name" id="first-file-name"></span>
                        </div>
                        <button id="send-first-message" class="btn btn-primary">Send to Onyx</button>
                    </div>
                    
                    <div class="user-menu-corner">
                        <button class="user-menu-trigger" id="user-menu-first">
                            <span id="username-first">User</span>
                        </button>
                        <div class="user-menu-dropdown" id="user-dropdown-first" style="display: none;">
                            <div class="user-menu-item" data-action="settings">Settings</div>
                            <div class="user-menu-item" data-action="payment">Payment</div>
                            <div class="user-menu-item" data-action="logout">Logout</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Workspace (3-tab layout) -->
            <div id="workspace-state" class="workspace-state" style="display: none;">
                <div class="workspace-layout">
                    <!-- Header Bar -->
                    <header class="workspace-header">
                        <h1 class="workspace-header-title">Workspace</h1>
                        <div class="workspace-header-right">
                            <button class="user-menu-trigger" id="user-menu-main">
                                <span id="username-main">User</span>
                            </button>
                            <div class="user-menu-dropdown" id="user-dropdown-main" style="display: none;">
                                <div class="user-menu-item" data-action="payment">Payment</div>
                                <div class="user-menu-item" data-action="logout">Logout</div>
                            </div>
                        </div>
                    </header>

                    <!-- Workspace Body -->
                    <div class="workspace-body">
                        <!-- Sidebar -->
                        <aside class="workspace-sidebar">
                            <nav class="sidebar-nav">
                                <button class="sidebar-nav-item active" data-tab="active">Active</button>
                                <button class="sidebar-nav-item" data-tab="library">Library</button>
                                <button class="sidebar-nav-item" data-tab="settings">Settings</button>
                            </nav>
                        </aside>

                        <!-- Main Content Area -->
                        <main class="workspace-content-area">
                        <!-- Active Tab -->
                        <div id="active-tab" class="workspace-tab active">
                            <!-- Summary Card -->
                            <div class="summary-card" id="summary-card" style="display: none;">
                                <div class="summary-header">Decision Summary</div>
                                <div class="summary-field">
                                    <label>Decision:</label>
                                    <p id="summary-decision">â€”</p>
                                </div>
                                <div class="summary-field">
                                    <label>Current Leaning:</label>
                                    <p id="summary-leaning">â€”</p>
                                </div>
                                <div class="summary-meta">
                                    <span>Last Update: <span id="summary-updated">Never</span></span>
                                    <span class="summary-status" id="summary-status">Draft</span>
                                </div>
                            </div>

                            <!-- Message Thread -->
                            <div class="message-thread" id="message-thread">
                                <!-- Messages populated by JS -->
                            </div>

                            <!-- Message Input -->
                            <div class="message-input-container">
                                <div class="message-input-wrapper">
                                    <textarea id="message-input" class="message-textarea" placeholder="Type your message..."></textarea>
                                    <div class="message-input-actions">
                                        <div class="file-upload-inline">
                                            <input type="file" id="message-file-input" accept="image/png,image/jpeg,application/pdf" style="display: none;">
                                            <button type="button" class="btn-attach" id="message-attach-btn">ðŸ“Ž</button>
                                            <span class="file-name" id="message-file-name"></span>
                                        </div>
                                        <button id="send-message-btn" class="btn btn-primary">Send</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Commit Section (shows when final recommendation exists) -->
                            <div id="commit-section" class="commit-section" style="display: none;">
                                <div class="commit-prompt">
                                    <p>Ready to commit to this direction?</p>
                                    <button id="commit-btn" class="btn btn-commit">Commit to this direction</button>
                                </div>
                            </div>
                        </div>

                        <!-- Library Tab -->
                        <div id="library-tab" class="workspace-tab" style="display: none;">
                            <div class="tab-header">
                                <h1>Library</h1>
                                <p class="tab-subtitle">All decisions you've worked through in Onyx.</p>
                            </div>
                            <div class="library-list" id="library-list">
                                <!-- Populated by JS -->
                            </div>
                            <div id="library-empty" class="empty-state-minimal" style="display: none;">
                                <p>No resolved conversations yet.</p>
                            </div>
                        </div>

                        <!-- Settings Tab -->
                        <div id="settings-tab" class="workspace-tab" style="display: none;">
                            <div class="tab-header">
                                <h1>Settings</h1>
                                <p class="tab-subtitle">Manage your account and preferences.</p>
                            </div>
                            <div class="settings-form">
                                <div class="form-group">
                                    <label>Display Name</label>
                                    <input type="text" id="settings-name" class="input" placeholder="Your name">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="settings-email" class="input" disabled>
                                    <p class="form-hint">Email cannot be changed</p>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="settings-email-notifications" checked>
                                        <span>Email me when admin responds</span>
                                    </label>
                                </div>
                                <div id="settings-saved-message" class="settings-message" style="display: none;">
                                    Settings saved
                                </div>
                            </div>
                        </div>
                    </main>
                </div> <!-- closes workspace-body -->
            </div> <!-- closes workspace-layout -->
        </div> <!-- closes workspace-state -->

        <!-- Edit Message Modal -->
        <div id="edit-modal" class="confirm-modal">
            <div class="confirm-modal-content">
                <div class="confirm-modal-header">
                    <h3 class="confirm-modal-title">Edit message</h3>
                </div>
                <div class="confirm-modal-body">
                    <label for="edit-modal-input">Message:</label>
                    <textarea id="edit-modal-input" class="confirm-modal-input"></textarea>
                </div>
                <div class="confirm-modal-actions">
                    <button class="confirm-modal-btn" id="edit-modal-cancel">Cancel</button>
                    <button class="confirm-modal-btn confirm-modal-btn-primary" id="edit-modal-ok">OK</button>
                </div>
            </div>
        </div>

        <!-- Delete Message Modal -->
        <div id="delete-modal" class="confirm-modal">
            <div class="confirm-modal-content">
                <div class="confirm-modal-header">
                    <h3 class="confirm-modal-title">Delete message</h3>
                </div>
                <div class="confirm-modal-body">
                    <p class="confirm-modal-text">Are you sure you want to delete this message? This action cannot be undone.</p>
                </div>
                <div class="confirm-modal-actions">
                    <button class="confirm-modal-btn" id="delete-modal-cancel">Cancel</button>
                    <button class="confirm-modal-btn confirm-modal-btn-danger" id="delete-modal-ok">Delete</button>
                </div>
            </div>
        </div>

        <!-- Conversation Detail Modal (for Library) -->
            <div id="conversation-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modal-title">Conversation</h2>
                        <button class="modal-close" id="modal-close">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <div class="summary-card-readonly" id="modal-summary">
                            <!-- Summary populated by JS -->
                        </div>
                        <div class="message-thread-readonly" id="modal-messages">
                            <!-- Messages populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="../js/workspace.js"></script>
</body>
</html>
